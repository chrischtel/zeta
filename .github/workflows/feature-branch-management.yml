name: Feature Branch Management

on:
  workflow_dispatch:
    inputs:
      action:
        description: 'Action to perform'
        required: true
        type: choice
        options:
          - create
          - ready-for-review
      featureName:
        description: 'Feature name (e.g., add-new-compiler-option)'
        required: true

jobs:
  manage-feature:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      
      - name: Configure Git
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "GitHub Actions"
      
      - name: Create feature branch
        if: ${{ github.event.inputs.action == 'create' }}
        run: |
          git checkout develop
          git pull
          git checkout -b feature/${{ github.event.inputs.featureName }}
          git push -u origin feature/${{ github.event.inputs.featureName }}
          echo "Feature branch created: feature/${{ github.event.inputs.featureName }}"
      
      - name: Create PR for review
        if: ${{ github.event.inputs.action == 'ready-for-review' }}
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          branch: feature/${{ github.event.inputs.featureName }}
          base: develop
          title: 'Feature: ${{ github.event.inputs.featureName }}'
          body: |
            ## Feature PR
            
            This PR is ready for review and contains the implementation of:
            `${{ github.event.inputs.featureName }}`
            
            ### Checklist
            - [ ] Code follows project style guidelines
            - [ ] Tests added/updated
            - [ ] Documentation updated
            - [ ] Feature complete and ready for review
          draft: false
          labels: feature,ready-for-review
